- name: Taint master node
  become: true
  command: |
    kubectl taint nodes {{ master_node_name }} CriticalAddonsOnly:NoSchedule --overwrite

- name: Label master node
  become: true
  command: |
    kubectl label node {{ master_node_name }} node-type=master --overwrite

- name: Add NFS provider as default storage class
  become: true
  template:
    src: nfs-storage.yaml.j2
    dest: /var/lib/rancher/k3s/server/manifests/nfs-storage.yaml

- name: Make local-storage provider non-default storage class
  become: true
  lineinfile: 
    path: /var/lib/rancher/k3s/server/manifests/local-storage.yaml
    regexp: '^\ \ \ \ storageclass.kubernetes.io/is-default-class: "true"$' 
    line: '    storageclass.kubernetes.io/is-default-class: "false"'
