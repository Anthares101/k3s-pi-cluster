---
- name: Initial setup
  hosts: nodes
  gather_facts: false
  tags: ['pi-initial-setup']

  collections:
    - community.general

  roles:
    - role: pi-initial-setup

- name: Configure the master node
  hosts: master
  gather_facts: false
  tags: ['install-k3s-master']

  roles:
    - role: install-k3s-master

- name: Configure the worker nodes
  hosts: workers
  gather_facts: false
  tags: ['install-k3s-workers']

  roles:
    - role: install-k3s-workers

- name: Configure NFS server
  hosts: localhost
  connection: local
  gather_facts: false
  tags: ['install-nfs-server']
  
  roles:
    - role: install-nfs-server

- name: Configure cluster
  hosts: master
  gather_facts: false
  tags: ['configure-cluster']

  collections:
    - community.kubernetes
  
  environment:
    # The location of the kubeconfig file in the local machine
    K8S_AUTH_KUBECONFIG: ~/.kube/config
  
  roles:
    - role: configure-cluster
